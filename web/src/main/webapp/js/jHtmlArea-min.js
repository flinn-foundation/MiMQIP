(function(a){a.fn.htmlarea=function(a){if(a&&typeof a==="string"){for(var e=[],c=1;c<arguments.length;c++)e.push(arguments[c]);var d=b(this[0]),f=d[a];if(f)return f.apply(d,e)}return this.each(function(){b(this,a)})};var b=window.jHtmlArea=function(a,c){return a.jquery?b(a[0]):a.jhtmlareaObject?a.jhtmlareaObject:new b.fn.init(a,c)};b.fn=b.prototype={jhtmlarea:"0.7.0",init:function(g,k){if(g.nodeName.toLowerCase()==="textarea"){var f=a.extend({},b.defaultOptions,k);g.jhtmlareaObject=this;var d=this.textarea=a(g),h=this.container=a("<div/>").addClass("jHtmlArea").width(d.width()).insertAfter(d),i=this.toolbar=a("<div/>").addClass("ToolBar").appendTo(h);c.initToolBar.call(this,f);var e=this.iframe=a("<iframe/>").height(d.height());$(e).attr('frameborder',0);e.width(d.width());var j=this.htmlarea=a("<div/>").append(e);$(e).attr('frameBorder',0);h.append(j).append(d.hide());c.initEditor.call(this,f);c.attachEditorEvents.call(this);e.height(e.height());f.loaded&&f.loaded.call(this)}},dispose:function(){this.textarea.show().insertAfter(this.container);this.container.remove();this.textarea[0].jhtmlareaObject=null},execCommand:function(a,b,c){this.iframe[0].contentWindow.focus();this.editor.execCommand(a,b||false,c||null);this.updateTextArea()},ec:function(a,b,c){this.execCommand(a,b,c)},queryCommandValue:function(a){this.iframe[0].contentWindow.focus();return this.editor.queryCommandValue(a)},qc:function(a){return this.queryCommandValue(a)},getSelectedHTML:function(){if(a.browser.msie)return this.getRange().htmlText;else{var b=this.getRange().cloneContents();return a("<p/>").append(a(b)).html()}},getSelection:function(){return a.browser.msie?this.editor.selection:this.iframe[0].contentDocument.defaultView.getSelection()},getRange:function(){var a=this.getSelection();return!a?null:a.getRangeAt?a.getRangeAt(0):a.createRange()},bold:function(){this.ec("bold")},italic:function(){this.ec("italic")},underline:function(){this.ec("underline")},removeFormat:function(){this.ec("removeFormat",false,[]);this.unlink()},toggleHTMLView:function(){this.textarea.is(":hidden")?this.showHTMLView():this.hideHTMLView()},toHtmlString:function(){return this.editor.body.innerHTML},updateTextArea:function(){this.textarea.val(this.toHtmlString())},updateHtmlArea:function(){this.editor.body.innerHTML=this.textarea.val()}};b.fn.init.prototype=b.fn;b.defaultOptions={toolbar:["bold","italic","underline"],css:null,toolbarText:{bold:"Bold",italic:"Italic",underline:"Underline"}};var c={toolbarButtons:{},initEditor:function(c){var a=this.editor=this.iframe[0].contentWindow.document;a.designMode="on";a.open();a.write(this.textarea.val());a.close();if(c.css){var b=a.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=c.css;a.getElementsByTagName("head")[0].appendChild(b)}},initToolBar:function(b){var g=this,f=function(b,c,d){return a("<li/>").append(a("<a href='javascript:void(0);'/>").addClass(b).attr("title",c).click(function(){d.call(g,a(this))}))};function e(i){for(var e=a("<ul/>").appendTo(g.toolbar),h=0;h<i.length;h++){var d=i[h];if((typeof d).toLowerCase()==="string")if(d==="|")e.append(a('<li class="separator"/>'));else{var j=function(b){var a=c.toolbarButtons[b]||b;return(typeof a).toLowerCase()==="function"?function(b){a.call(this,b)}:function(){this[a]();this.editor.body.focus()}}(d.toLowerCase()),k=b.toolbarText[d.toLowerCase()];e.append(f(d.toLowerCase(),k||d,j))}else e.append(f(d.css,d.text,d.action))}}if(b.toolbar.length!==0&&c.isArray(b.toolbar[0]))for(var d=0;d<b.toolbar.length;d++)e(b.toolbar[d]);else e(b.toolbar)},attachEditorEvents:function(){var d=this,b=function(){d.updateHtmlArea()};this.textarea.click(b).keyup(b).keydown(b).mousedown(b).blur(b);var c=function(){d.updateTextArea()};a(this.editor.body).click(c).keyup(c).keydown(c).mousedown(c).blur(c);/*a("form").submit(function(){d.toggleHTMLView();d.toggleHTMLView()})*/},isArray:function(a){return a&&typeof a==="object"&&typeof a.length==="number"&&typeof a.splice==="function"&&!a.propertyIsEnumerable("length")}}})(jQuery);