<html>
<head>
<title>Flinn MQIP Test Suite</title>
<style type="text/css">

        body {
                margin-top: 0px;
                margin-left: 0px;
                margin-right: 0px;
                margin-bottom: 0px;
                background-color: #ffffff;
                color: #333333;
                font-family: verdana,arial,helvetica,sans-serif;
                font-size: 12px;
                font-style: normal;
                line-height: normal;
                font-weight: normal;
                font-variant: normal;
                text-transform: none;
        }

        a:link      { color: #111111; text-decoration: underline }
        a:active         { color: #333333; text-decoration: underline }
        a:visited       { color: #333333; text-decoration: underline }
        a:hover  { color: #666666; text-decoration: underline }
        #container {
                margin-top: 0px;
                margin-left: 5px;
                text-align: left;
                width: 1270px;
                margin-left: auto;
                margin-right: auto;
        }
        #forms {
                margin-top: 0px;
                margin-left: 5px;
                margin-right: 50px;
                margin-bottom: 0px;
                width: 400px;
                height: 690px;
                float: left;
                display: inline;
        }
        #result {
                margin-top: 0px;
                margin-left: 5px;
                margin-right: 50px;
                margin-bottom: 0px;
                width: 740px;
                height: 300px;
                display: inline;
        }
        #submit {
                margin-top: 0px;
                margin-left: 5px;
                margin-right: 50px;
                margin-bottom: 0px;
                width: 740px;
                height: 300px;
                display: inline;
        }

</style>
<script type="text/javascript" language="JavaScript" src="jquery-1.2.6.min.js"></script>
<script type="text/javascript" language="JavaScript" src="json.js"></script>
<script type="text/javascript" language="JavaScript" src="cookie.js"></script>
<script type="text/javascript" language="JavaScript 1.2">
<!--
var request = {};
var action = {};

action.type='read';
action.command='patient';
action.authcode='auth';
action.messageid='1';
action.correlationid='1';
action.interfaceversion='1.0';
action.clientidentifier='MQIP';
request.action = action;

function submitRequest() {
  var submission = buildJSON();

  document.getElementById("submitframe").contentWindow.document.body.innerHTML = "<pre>"+JSON.stringify(request,null,2)+"</pre>";
  document.getElementById("resultframe").contentWindow.document.body.innerHTML = "Submission Started...";

  $.ajax({
    type: "POST",
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    url: "/MQIP?format=json",
    data: submission, 
    processData: true,
    cache: false,
    complete: function(xhr,textstatus) { submitComplete(xhr,textstatus); },
    error: function(xhr,textstatus) { submitError(xhr,textstatus); },
    success: function(msg,textstatus) { submitSuccess(msg,textstatus); }
  });

}

function submitXMLRequest() {
  var submission = buildXML();
  var re1 = /</g;
  var re2 = />/g;
  document.getElementById("submitframe").contentWindow.document.body.innerHTML = submission.replace(re1,"&lt;").replace(re2,"&gt;");

  $.ajax({
    type: "POST",
    contentType: "application/xml; charset=utf-8",
    dataType: "xml",
    url: "/MQIP?format=xml",
    data: submission, 
    processData: true,
    cache: false,
    complete: function(xhr,textstatus) { submitComplete(xhr,textstatus); },
    error: function(xhr,textstatus) { submitError(xhr,textstatus); },
    success: function(msg,textstatus) { submitXMLSuccess(msg,textstatus); }
  });

}
function submitComplete(xhr,textstatus) {
  // document.getElementById("resultframe").contentWindow.document.body.innerHTML = "Submission Sent..."+textstatus;
}
function submitError(xhr,textstatus) {
  document.getElementById("resultframe").contentWindow.document.body.innerHTML = "Error..."+textstatus;
}
function submitSuccess(msg,textstatus) {
  document.getElementById("resultframe").contentWindow.document.body.innerHTML = "Success..."+textstatus+"<br/><pre>"+JSON.stringify(msg,null,2)+"</pre>";
  if (msg.patient) {
    if (msg.patient.facilityid && document.forms['other'].facilityid) document.forms['other'].facilityid.value = msg.patient.facilityid;
    if (msg.patient.patientid && document.forms['other'].patientid) document.forms['other'].patientid.value = msg.patient.patientid;
    if (msg.patient.valid && document.forms['other'].valid) document.forms['other'].valid.value = msg.patient.valid;
    if (msg.patient.startdate && document.forms['other'].startdate) document.forms['other'].startdate.value = msg.patient.startdate;
    if (document.forms['other'].shortform.value == "true") {
      if (msg.patient.details) {
        if (msg.patient.details.firstname && document.forms['other'].firstname) document.forms['other'].firstname.value = msg.patient.details.firstname;
        if (msg.patient.patientidentifier && document.forms['other'].patientidentifier) document.forms['other'].patientidentifier.value = msg.patient.details.patientidentifier;
        if (msg.patient.details.lastname && document.forms['other'].lastname) document.forms['other'].lastname.value = msg.patient.details.lastname;
        if (msg.patient.details.sex && document.forms['other'].sex) document.forms['other'].sex.value = msg.patient.details.sex;
        if (msg.patient.details.race && document.forms['other'].race) document.forms['other'].race.value = msg.patient.details.race;
        if (msg.patient.details.birth && document.forms['other'].birth) document.forms['other'].birth.value = msg.patient.details.birth;
        if (msg.patient.details.zip && document.forms['other'].zip) document.forms['other'].zip.value = msg.patient.details.zip;
        if (msg.patient.details.marital && document.forms['other'].marital) document.forms['other'].marital.value = msg.patient.details.marital;
        if (msg.patient.details.employment && document.forms['other'].employment) document.forms['other'].employment.value = msg.patient.details.employment;
        if (msg.patient.details.living && document.forms['other'].living) document.forms['other'].living.value = msg.patient.details.living;
      }
    } else {
      if (msg.patient.details) {
        if (msg.patient.details.firstname && document.forms['other'].firstname) document.forms['other'].firstname.value = msg.patient.details.firstname[0].value;
        if (msg.patient.details.lastname && document.forms['other'].lastname) document.forms['other'].lastname.value = msg.patient.details.lastname[0].value;
        if (msg.patient.details.sex && document.forms['other'].sex) document.forms['other'].sex.value = msg.patient.details.sex[0].value;
        if (msg.patient.details.race && document.forms['other'].race) document.forms['other'].race.value = msg.patient.details.race[0].value;
        if (msg.patient.details.birth && document.forms['other'].birth) document.forms['other'].birth.value = msg.patient.details.birth[0].value;
        if (msg.patient.details.zip && document.forms['other'].zip) document.forms['other'].zip.value = msg.patient.details.zip[0].value;
        if (msg.patient.details.marital && document.forms['other'].marital) document.forms['other'].marital.value = msg.patient.details.marital[0].value;
        if (msg.patient.details.employment && document.forms['other'].employment) document.forms['other'].employment.value = msg.patient.details.employment[0].value;
        if (msg.patient.details.living && document.forms['other'].living) document.forms['other'].living.value = msg.patient.details.living[0].value;
      }
    }
  }
}
function submitXMLSuccess(msg,textstatus) {
  // document.getElementById("resultframe").contentWindow.document.body.innerHTML = msg;
  if (msg.xml) xmlString = msg.xml;
  else xmlString = (new XMLSerializer()).serializeToString(msg);
  var re1 = /</g;
  var re2 = />/g;
  document.getElementById("resultframe").contentWindow.document.body.innerHTML = xmlString.replace(re1,"&lt;").replace(re2,"&gt;");
}

function buildJSON() {
  request.action.type = document.forms['action'].type.value;
  request.action.command = document.forms['action'].command.value;
  request.action.authcode = document.forms['action'].authcode.value;
  request.action.messageid = document.forms['action'].messageid.value;
  request.action.correlationid = document.forms['action'].correlationid.value;
  request.action.interfaceversion = document.forms['action'].interfaceversion.value;
  request.action.clientidentifier = document.forms['action'].clientidentifier.value;
  request.action.timestamp = new Date().getTime();
  request.patient = {};
  if (document.forms['other'].shortform.value != "") request.patient.shortform = document.forms['other'].shortform.value;
  if (document.forms['other'].statusprefix.value != "") request.patient.statusprefix = document.forms['other'].statusprefix.value;
  if (document.forms['other'].facilityid.value != "") request.patient.facilityid = document.forms['other'].facilityid.value;
  if (document.forms['other'].patientid.value != "") request.patient.patientid = document.forms['other'].patientid.value;
  if (document.forms['other'].valid.value != "") request.patient.valid = document.forms['other'].valid.value;
  if (document.forms['other'].startdate.value != "") request.patient.startdate = document.forms['other'].startdate.value;
  request.patient.details = {};
  if (document.forms['other'].patientidentifier.value != "") request.patient.details.patientidentifier = document.forms['other'].patientidentifier.value;
  if (document.forms['other'].firstname.value != "") request.patient.details.firstname = document.forms['other'].firstname.value;
  if (document.forms['other'].lastname.value != "") request.patient.details.lastname = document.forms['other'].lastname.value;
  if (document.forms['other'].sex.value != "") request.patient.details.sex = document.forms['other'].sex.value;
  if (document.forms['other'].race.value != "") request.patient.details.race = document.forms['other'].race.value;
  if (document.forms['other'].birth.value != "") request.patient.details.birth = document.forms['other'].birth.value;
  if (document.forms['other'].zip.value != "") request.patient.details.zip = document.forms['other'].zip.value;
  if (document.forms['other'].marital.value != "") request.patient.details.marital = document.forms['other'].marital.value;
  if (document.forms['other'].employment.value != "") request.patient.details.employment = document.forms['other'].employment.value;
  if (document.forms['other'].living.value != "") request.patient.details.living = document.forms['other'].living.value;
  return JSON.stringify(request);
}

function buildXML() {
  retstr = "<request><action>";
  retstr += "<type>"+document.forms['action'].type.value+"</type>";
  retstr += "<command>"+document.forms['action'].command.value+"</command>";
  retstr += "<authcode>"+document.forms['action'].authcode.value+"</authcode>";
  retstr += "<messageid>"+document.forms['action'].messageid.value+"</messageid>";
  retstr += "<correlationid>"+document.forms['action'].correlationid.value+"</correlationid>";
  retstr += "<interfaceversion>"+document.forms['action'].interfaceversion.value+"</interfaceversion>";
  retstr += "<clientidentifier>"+document.forms['action'].clientidentifier.value+"</clientidentifier>";
  retstr += "<timestamp>"+(new Date().getTime())+"</timestamp>";
  retstr += "</action><patient>";

  if (document.forms['other'].shortform.value != "") retstr += "<shortform>"+document.forms['other'].shortform.value+"</shortform>";
  if (document.forms['other'].statusprefix.value != "") retstr += "<statusprefix>"+document.forms['other'].statusprefix.value+"</statusprefix>";
  if (document.forms['other'].facilityid.value != "") retstr += "<facilityid>"+document.forms['other'].facilityid.value+"</facilityid>";
  if (document.forms['other'].patientid.value != "") retstr += "<patientid>"+document.forms['other'].patientid.value+"</patientid>";
  if (document.forms['other'].valid.value != "") retstr += "<valid>"+document.forms['other'].valid.value+"</valid>";
  if (document.forms['other'].startdate.value != "") retstr += "<startdate>"+document.forms['other'].startdate.value+"</startdate>";
  retstr += "<details>";
  if (document.forms['other'].patientidentifier.value != "") retstr += "<patientidentifier>"+document.forms['other'].patientidentifier.value+"</patientidentifier>";
  if (document.forms['other'].firstname.value != "") retstr += "<firstname>"+document.forms['other'].firstname.value+"</firstname>";
  if (document.forms['other'].lastname.value != "") retstr += "<lastname>"+document.forms['other'].lastname.value+"</lastname>";
  if (document.forms['other'].sex.value != "") retstr += "<sex>"+document.forms['other'].sex.value+"</sex>";
  if (document.forms['other'].race.value != "") retstr += "<race>"+document.forms['other'].race.value+"</race>";
  if (document.forms['other'].birth.value != "") retstr += "<birth>"+document.forms['other'].birth.value+"</birth>";
  if (document.forms['other'].zip.value != "") retstr += "<zip>"+document.forms['other'].zip.value+"</zip>";
  if (document.forms['other'].marital.value != "") retstr += "<marital>"+document.forms['other'].marital.value+"</marital>";
  if (document.forms['other'].employment.value != "") retstr += "<employment>"+document.forms['other'].employment.value+"</employment>";
  if (document.forms['other'].living.value != "") retstr += "<living>"+document.forms['other'].living.value+"</living>";
  retstr += "</details>";

  retstr += "</patient></request>";
  return retstr;
}

// -->
</script>
</head>
<body onload="setAuthCode()">
<div id='container'>
<div id='forms'>
<a href="authenticate.html">Login/Authentication operations</a><br/>
<a href="session.html">Session operations</a><br/>
<a href="facility.html">Facility operations (unused from interface)</a><br/>
<a href="patientsearch.html">Patient Search operations</a><br/>
<a href="patient.html">Patient operations</a><br/>
<a href="patientage.html">Patient Data Aging operations</a><br/>
<a href="progressnotetags.html">Progress Note Tags operations</a><br/>
<a href="progressnotesearch.html">Progress Note Search operations</a><br/>
<a href="progressnote.html">Progress Note operations</a><br/>
<a href="labtests.html">Lab Test operations</a><br/>
<a href="labsearch.html">Lab Search operations</a><br/>
<a href="lab.html">Lab operations</a><br/>
<a href="initialstaging.html">Recommendation Engine - Initial Staging operations</a><br/>
<a href="recommendation.html">Recommendation Engine - Recommendation Request operations</a><br/>
<a href="guidelinereason.html">Recommendation Engine - Reason no Guideline operations</a><br/>
<a href="prescription.html">Prescription operations</a><br/>
<a href="prescriptionsearch.html">Prescription Search operations</a><br/>
<a href="treatment.html">Treatment operations</a><br/>
<br/>
<strong>Action Elements</strong><br/>
<form name='action' id='action'>
type: <input name="type" value='read' /><br/>
command: <input name="command" value='patient' /><br/>
authcode: <input name="authcode" value='' /><br/>
messageid: <input name="messageid" value='1' /><br/>
correlationid: <input name="correlationid" value='1' /><br/>
interfaceversion: <input name="interfaceversion" value='1.0' /><br/>
clientidentifier: <input name="clientidentifier" value='MQIP' /><br/>
</form>
<hr/>
<strong>Other Request Elements</strong><br/>
<form name='other' id='other'>
shortform: <input name="shortform" value='false' /><br/>
statusprefix: <input name="statusprefix" value='' /><br/>
facilityid: <input name="facilityid" value='' /><br/>
patientid: <input name="patientid" value='' /><br/>
patientidentifier: <input name="patientidentifier" value='' /><br/>
valid: <input name="valid" value='true' /><br/>
startdate: <input name="startdate" value='' /><br/>
firstname: <input name="firstname" value='' /><br/>
lastname: <input name="lastname" value='' /><br/>
sex: <input name="sex" value='' /><br/>
race: <input name="race" value='' /><br/>
birth: <input name="birth" value='' /><br/>
zip: <input name="zip" value='' /><br/>
marital: <input name="marital" value='' /><br/>
employment: <input name="employment" value='' /><br/>
living: <input name="living" value='' /><br/>
</form>
<hr/>
<a href="javascript:submitRequest()">Submit JSON Request</a><br/>
<a href="javascript:submitXMLRequest()">Submit XML Request</a><br/>
<hr/>
<strong>Notes:</strong><br/>
Only read is a valid type for search.<br/>
Valid commands are:<br/>
.....<br/>
=====================<br/>
</div>
<div id='result'> <strong>Your Results Here.</strong><br/>
<iframe frameborder=1 height="300" width='700' name="resultframe" id="resultframe" scrolling="yes" src='./'></iframe>
<br/><strong>Your Submission Here.</strong><br/>
<iframe frameborder=1 height="300" width='700' name="submitframe" id="submitframe" scrolling="yes" src='./'></iframe></div>
</div>
</body>
</html>
